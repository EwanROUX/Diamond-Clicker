<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinity Clicker - Prestige Edition</title>
    <style>
        /* --- STYLE CSS --- */
        :root {
            --bg-dark: #0d0d10;
            --bg-panel: #1a1a1e;
            --primary: #a855f7;
            --primary-hover: #c084fc;
            --gold: #fbbf24;
            --prestige: #06b6d4;
            --text-main: #f3f4f6;
            --text-muted: #9ca3af;
            --danger: #ef4444;
            --success: #22c55e;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
            user-select: none;
        }

        /* --- ZONE DE JEU (GAUCHE) --- */
        .game-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at bottom, #2e1065 0%, #0d0d10 70%);
            position: relative;
        }

        /* Diamant Dor√© (Event) */
        #golden-diamond {
            position: absolute;
            font-size: 3rem;
            cursor: pointer;
            z-index: 100;
            animation: bounce 1s infinite;
            filter: drop-shadow(0 0 10px gold);
            display: none; /* Cach√© par d√©faut */
        }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .currency-info { text-align: center; margin-bottom: 2rem; z-index: 10; }
        .big-score { font-size: 3.5rem; font-weight: 800; line-height: 1.1; text-shadow: 0 0 20px rgba(168, 85, 247, 0.3); }
        .score-sub { font-size: 1.1rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
        .gps-display { color: var(--success); font-weight: bold; font-size: 1.1rem; margin-top: 5px; }
        
        /* Affichage Prestige */
        .prestige-badge {
            background: rgba(6, 182, 212, 0.15);
            color: var(--prestige);
            border: 1px solid var(--prestige);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 15px;
            display: inline-block;
        }

        .main-clicker {
            font-size: 9rem;
            cursor: pointer;
            transition: transform 0.05s;
            filter: drop-shadow(0 0 40px rgba(168, 85, 247, 0.2));
            z-index: 5;
        }
        .main-clicker:active { transform: scale(0.94); }

        /* Particules */
        .particle {
            position: absolute;
            pointer-events: none;
            font-weight: bold;
            font-size: 1.2rem;
            animation: floatUp 1s forwards;
            color: white;
        }
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-60px); }
        }

        /* --- PANNEAU DROITE --- */
        .panel {
            width: 420px;
            background-color: var(--bg-panel);
            border-left: 1px solid #333;
            display: flex;
            flex-direction: column;
            box-shadow: -10px 0 20px rgba(0,0,0,0.5);
        }

        /* Onglets */
        .tabs { display: flex; background: #111; }
        .tab-btn {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            color: #777;
            font-weight: 700;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: 0.2s;
        }
        .tab-btn:hover { color: #bbb; background: #1a1a1e; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); background: #1a1a1e; }
        
        /* Contenu */
        .content { flex: 1; overflow-y: auto; padding: 15px; }
        .content::-webkit-scrollbar { width: 6px; }
        .content::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }

        /* Cartes B√¢timents */
        .card {
            background: #25252b;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: 0.2s;
            border: 1px solid transparent;
        }
        .card:hover { border-color: #444; transform: translateX(2px); }
        .card-icon { font-size: 2rem; margin-right: 15px; width: 40px; text-align: center; }
        .card-info { flex: 1; }
        .card-name { font-weight: bold; font-size: 1rem; margin: 0; }
        .card-cost { color: var(--gold); font-size: 0.9rem; }
        .card-count { font-size: 1.2rem; font-weight: bold; color: #555; margin-right: 15px; }

        .btn-buy {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-buy:hover { filter: brightness(1.1); }
        .btn-buy:disabled { background: #333; color: #666; cursor: not-allowed; }

        /* Onglet Prestige */
        .prestige-container { text-align: center; padding: 20px; }
        .prestige-btn {
            background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%);
            width: 100%;
            padding: 15px;
            border: none;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.4);
        }
        .prestige-btn:disabled { opacity: 0.5; cursor: not-allowed; box-shadow: none; background: #333; }
        
        /* Onglet Stats */
        .stat-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #333; color: #ccc; }

        .hidden { display: none !important; }

        @media (max-width: 800px) {
            body { flex-direction: column; }
            .panel { width: 100%; height: 55vh; }
            .game-section { height: 45vh; }
            .main-clicker { font-size: 6rem; }
            .big-score { font-size: 2.5rem; }
        }
    </style>
</head>
<body>

    <div id="golden-diamond">üíé</div>

    <div class="game-section">
        <div class="currency-info">
            <div id="prestige-display" class="prestige-badge hidden">
                ‚ú® 0 Gemmes Cosmiques (+0%)
            </div>
            <div class="big-score" id="score">0</div>
            <div class="score-sub">Diamants</div>
            <div class="gps-display" id="gps">0 / sec</div>
        </div>

        <div class="main-clicker" id="clicker">üíé</div>
    </div>

    <div class="panel">
        <div class="tabs">
            <button class="tab-btn active" onclick="setTab('buildings')">Industrie</button>
            <button class="tab-btn" onclick="setTab('prestige')">Galaxie</button>
            <button class="tab-btn" onclick="setTab('stats')">Stats</button>
        </div>

        <div class="content">
            
            <div id="tab-buildings">
                </div>

            <div id="tab-prestige" class="hidden">
                <div class="prestige-container">
                    <h2 style="color:var(--prestige)">Renaissance Galactique</h2>
                    <p style="color:#aaa; font-size:0.9rem;">
                        R√©initialisez votre progression pour gagner des <b>Gemmes Cosmiques</b>.
                        <br><br>
                        Chaque Gemme augmente votre production de <b>+10%</b> de fa√ßon permanente.
                    </p>
                    
                    <div style="background:#222; padding:15px; border-radius:8px; margin:20px 0;">
                        <div style="font-size:0.9rem; color:#888;">Gemmes actuelles</div>
                        <div style="font-size:2rem; font-weight:bold; color:var(--prestige);" id="current-gems">0</div>
                    </div>

                    <div style="background:#222; padding:15px; border-radius:8px; border:1px solid #333;">
                        <div style="font-size:0.9rem; color:#888;">Gemmes √† gagner au reset</div>
                        <div style="font-size:2rem; font-weight:bold; color:var(--success);" id="claimable-gems">0</div>
                    </div>

                    <button id="btn-prestige" class="prestige-btn" onclick="doPrestige()">
                        üåå SAUTER DANS LE VIDE
                    </button>
                    <p style="font-size:0.8rem; color:#666; margin-top:10px;">Requiert min. 1 Million de diamants cumul√©s</p>
                </div>
            </div>

            <div id="tab-stats" class="hidden">
                <h3 style="margin-top:0">Statistiques</h3>
                <div class="stat-row"><span>Temps de jeu</span> <span id="stat-time">0h 0m</span></div>
                <div class="stat-row"><span>Clics manuels</span> <span id="stat-clicks">0</span></div>
                <div class="stat-row"><span>Diamants dor√©s attrap√©s</span> <span id="stat-golden">0</span></div>
                <div class="stat-row"><span>Score total (Cette vie)</span> <span id="stat-total-life">0</span></div>
                <div class="stat-row"><span>Score total (Depuis toujours)</span> <span id="stat-total-all">0</span></div>
                <div class="stat-row"><span>Nombre de Prestiges</span> <span id="stat-prestiges">0</span></div>

                <div style="margin-top:30px; text-align:center;">
                    <button onclick="hardReset()" style="background:#333; color:#ef4444; border:1px solid #ef4444; padding:5px 10px; cursor:pointer;">
                        üõë HARD RESET (Supprimer sauvegarde)
                    </button>
                </div>
            </div>

        </div>
    </div>

    <script>
        /* --- CONFIGURATION --- */
        
        // Configuration des 12 b√¢timents (Courbe de progression √©tudi√©e)
        const buildingsConfig = [
            { id: 0, name: "Curseur", icon: "üñ±Ô∏è", baseCost: 15, baseProd: 0.1 },
            { id: 1, name: "Stagiaire", icon: "üë§", baseCost: 100, baseProd: 1 },
            { id: 2, name: "Mine", icon: "‚õèÔ∏è", baseCost: 1100, baseProd: 8 },
            { id: 3, name: "Usine", icon: "üè≠", baseCost: 12000, baseProd: 47 },
            { id: 4, name: "Banque", icon: "üè¶", baseCost: 130000, baseProd: 260 },
            { id: 5, name: "Temple", icon: "üõï", baseCost: 1400000, baseProd: 1400 },
            { id: 6, name: "Tour de Mage", icon: "üßô‚Äç‚ôÇÔ∏è", baseCost: 20000000, baseProd: 7800 },
            { id: 7, name: "Fus√©e", icon: "üöÄ", baseCost: 330000000, baseProd: 44000 },
            { id: 8, name: "Colonie Alien", icon: "üëΩ", baseCost: 5100000000, baseProd: 260000 }, // 5.1 Milliards
            { id: 9, name: "Portail", icon: "üåÄ", baseCost: 75000000000, baseProd: 1600000 }, // 75 Milliards
            { id: 10, name: "Machine Temporelle", icon: "‚è≥", baseCost: 1000000000000, baseProd: 10000000 }, // 1 Trillion
            { id: 11, name: "Simulateur R√©alit√©", icon: "üß†", baseCost: 14000000000000, baseProd: 65000000 } // 14 Trillions
        ];

        // √âtat du jeu (Initial)
        const initialState = {
            score: 0,
            totalScoreRun: 0, // Score total de cette "vie" (pour calcul prestige)
            totalScoreAllTime: 0,
            startTime: Date.now(),
            clickCount: 0,
            goldenClicks: 0,
            prestigeCount: 0,
            prestigeGems: 0,
            buildings: Array(buildingsConfig.length).fill(0)
        };

        let game = JSON.parse(JSON.stringify(initialState));

        /* --- SYST√àME DE NOTATION (Milliards, Trillions...) --- */
        const suffixes = ["", "k", "M", "B", "T", "Qa", "Qi", "Sx", "Sp", "Oc", "No", "Dc"];

        function formatNum(num) {
            if (num < 1000) return Math.floor(num);
            // Recherche du suffixe
            const tier = Math.floor(Math.log10(num) / 3);
            if (tier <= 0) return Math.floor(num);
            const suffix = suffixes[tier] || "??";
            const scale = Math.pow(10, tier * 3);
            const scaled = num / scale;
            return scaled.toFixed(2) + suffix;
        }

        /* --- MOTEUR DU JEU --- */

        // Calculs
        function getBuildingCost(id) {
            return buildingsConfig[id].baseCost * Math.pow(1.15, game.buildings[id]);
        }

        function getGPS() {
            let gps = 0;
            buildingsConfig.forEach(b => {
                gps += b.baseProd * game.buildings[b.id];
            });
            // Appliquer Bonus Prestige (1 Gemme = +10%)
            const prestigeMultiplier = 1 + (game.prestigeGems * 0.10);
            return gps * prestigeMultiplier;
        }

        function getClickValue() {
            // Un clic = 1 + 2% du GPS (pour rester pertinent)
            const raw = 1 + (getGPS() * 0.02);
            return raw;
        }

        // Boucle Principale
        setInterval(() => {
            const gps = getGPS();
            if (gps > 0) {
                const earned = gps / 30; // 30 FPS
                addScore(earned);
            }
            updateUI();
        }, 33);

        // Sauvegarde Auto (toutes les 10s)
        setInterval(() => {
            saveGame();
        }, 10000);

        // Diamant Dor√© (toutes les 60 √† 180 secondes al√©atoirement)
        let goldenTimeout;
        function scheduleGolden() {
            const delay = (Math.random() * 120000) + 60000; // entre 1min et 3min
            clearTimeout(goldenTimeout);
            goldenTimeout = setTimeout(spawnGolden, delay);
        }
        
        function spawnGolden() {
            const el = document.getElementById('golden-diamond');
            // Position al√©atoire dans la zone de jeu
            const x = Math.random() * 80 + 10; // %
            const y = Math.random() * 80 + 10; // %
            el.style.left = x + '%';
            el.style.top = y + '%';
            el.style.display = 'block';

            // Dispara√Æt apr√®s 15s si pas cliqu√©
            setTimeout(() => {
                el.style.display = 'none';
                scheduleGolden();
            }, 15000);
        }

        document.getElementById('golden-diamond').addEventListener('click', (e) => {
            e.stopPropagation(); // Emp√™che le clic normal
            const el = document.getElementById('golden-diamond');
            el.style.display = 'none';
            
            // Gain : 5 minutes de production ou 500 clics
            const bonus = Math.max(getGPS() * 300, getClickValue() * 500); 
            addScore(bonus);
            game.goldenClicks++;
            
            // Feedback
            createFloatingText(e.clientX, e.clientY, "+ " + formatNum(bonus) + " !!!", "#fbbf24");
            scheduleGolden();
        });
        scheduleGolden(); // Lancer le premier timer

        function addScore(amount) {
            game.score += amount;
            game.totalScoreRun += amount;
            game.totalScoreAllTime += amount;
        }

        /* --- PRESTIGE SYSTEM --- */
        function calcPrestigeGain() {
            // Formule : Racine Carr√©e du (Score Total de la Vie / 1 Million)
            if (game.totalScoreRun < 1000000) return 0;
            return Math.floor(Math.sqrt(game.totalScoreRun / 1000000));
        }

        function doPrestige() {
            const gain = calcPrestigeGain();
            if (gain <= 0) return;

            if (!confirm(`RESET : Vous allez perdre vos b√¢timents et votre score actuel.\nEn √©change, vous gagnez ${gain} Gemmes Cosmiques.\n\nConfirmer ?`)) return;

            // Garder les stats persistantes et les gemmes
            const newGems = game.prestigeGems + gain;
            const newPrestigeCount = game.prestigeCount + 1;
            const oldTotal = game.totalScoreAllTime;
            const oldClicks = game.clickCount;
            const oldGolden = game.goldenClicks;
            const oldTime = game.startTime;

            // Reset l'√©tat
            game = JSON.parse(JSON.stringify(initialState));
            
            // Restaurer ce qu'on garde
            game.prestigeGems = newGems;
            game.prestigeCount = newPrestigeCount;
            game.totalScoreAllTime = oldTotal;
            game.clickCount = oldClicks;
            game.goldenClicks = oldGolden;
            game.startTime = oldTime; // On ne reset pas le temps de jeu global

            saveGame();
            renderBuildings(); // Reset visuel des co√ªts
            switchTab('buildings'); // Retour au jeu
        }

        /* --- UI & INTERACTION --- */

        function updateUI() {
            document.getElementById('score').innerText = formatNum(game.score);
            document.getElementById('gps').innerText = formatNum(getGPS()) + " / sec";
            
            // Update Boutons Achat
            buildingsConfig.forEach(b => {
                const btn = document.getElementById(`btn-buy-${b.id}`);
                const costDisplay = document.getElementById(`cost-${b.id}`);
                if (btn) {
                    const cost = getBuildingCost(b.id);
                    btn.disabled = game.score < cost;
                    costDisplay.innerText = formatNum(cost);
                    // Griser la carte si trop cher (optionnel)
                }
            });

            // Update Prestige
            if (game.prestigeGems > 0) {
                const pDisplay = document.getElementById('prestige-display');
                pDisplay.classList.remove('hidden');
                pDisplay.innerText = `‚ú® ${formatNum(game.prestigeGems)} Gemmes (+${formatNum(game.prestigeGems * 10)}%)`;
            }

            // Calcul gain prestige potentiel
            const potential = calcPrestigeGain();
            document.getElementById('claimable-gems').innerText = formatNum(potential);
            document.getElementById('current-gems').innerText = formatNum(game.prestigeGems);
            document.getElementById('btn-prestige').disabled = potential <= 0;

            // Stats update
            if (!document.getElementById('tab-stats').classList.contains('hidden')) {
                updateStats();
            }
        }

        function updateStats() {
            const now = Date.now();
            const diff = now - game.startTime;
            const hours = Math.floor(diff / 3600000);
            const minutes = Math.floor((diff % 3600000) / 60000);
            
            document.getElementById('stat-time').innerText = `${hours}h ${minutes}m`;
            document.getElementById('stat-clicks').innerText = formatNum(game.clickCount);
            document.getElementById('stat-golden').innerText = game.goldenClicks;
            document.getElementById('stat-total-life').innerText = formatNum(game.totalScoreRun);
            document.getElementById('stat-total-all').innerText = formatNum(game.totalScoreAllTime);
            document.getElementById('stat-prestiges').innerText = game.prestigeCount;
        }

        // G√©n√©ration Liste B√¢timents
        function renderBuildings() {
            const container = document.getElementById('tab-buildings');
            container.innerHTML = "";
            
            buildingsConfig.forEach(b => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <div class="card-icon">${b.icon}</div>
                    <div class="card-info">
                        <h4 class="card-name">${b.name}</h4>
                        <div class="card-cost">üíé <span id="cost-${b.id}">0</span></div>
                    </div>
                    <div class="card-count" id="count-${b.id}">${game.buildings[b.id]}</div>
                    <button class="btn-buy" id="btn-buy-${b.id}" onclick="buyBuilding(${b.id})">Acheter</button>
                `;
                container.appendChild(div);
            });
        }

        function buyBuilding(id) {
            const cost = getBuildingCost(id);
            if (game.score >= cost) {
                game.score -= cost;
                game.buildings[id]++;
                // Update imm√©diat du count
                document.getElementById(`count-${id}`).innerText = game.buildings[id];
                updateUI(); // Force update boutons
            }
        }

        // Clic Manuel
        document.getElementById('clicker').addEventListener('click', (e) => {
            const val = getClickValue();
            addScore(val);
            game.clickCount++;
            
            createFloatingText(e.clientX, e.clientY, "+" + formatNum(val));
            
            const el = document.getElementById('clicker');
            el.style.transform = "scale(0.94)";
            setTimeout(() => el.style.transform = "scale(1)", 50);
        });

        function createFloatingText(x, y, text, color = "white") {
            const el = document.createElement('div');
            el.className = 'particle';
            el.innerText = text;
            el.style.color = color;
            // Un peu de hasard sur la position X
            const rX = (Math.random() - 0.5) * 40;
            el.style.left = (x + rX) + 'px';
            el.style.top = (y - 20) + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        /* --- SAUVEGARDE & CHARGEMENT --- */
        function saveGame() {
            localStorage.setItem('infinityClickerSave', JSON.stringify(game));
        }

        function loadGame() {
            const saved = localStorage.getItem('infinityClickerSave');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    // Merge safe (au cas o√π on ajoute des variables plus tard)
                    game = { ...initialState, ...parsed };
                    
                    // S√©curit√© array buildings si on ajoute des b√¢timents
                    if (game.buildings.length < buildingsConfig.length) {
                        const diff = buildingsConfig.length - game.buildings.length;
                        for(let i=0; i<diff; i++) game.buildings.push(0);
                    }
                } catch (e) { console.error("Save corrompue", e); }
            }
        }

        function hardReset() {
            if (confirm("ATTENTION : Cela va effacer TOUTE votre progression (y compris le prestige). √ätes-vous s√ªr ?")) {
                localStorage.removeItem('infinityClickerSave');
                location.reload();
            }
        }

        /* --- ONGLETS --- */
        window.setTab = function(tabName) {
            // Hide all
            ['buildings', 'prestige', 'stats'].forEach(t => {
                document.getElementById('tab-' + t).classList.add('hidden');
            });
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));

            // Show one
            document.getElementById('tab-' + tabName).classList.remove('hidden');
            // Trouver le bouton (m√©thode simple via index ou texte, ici on recupere l'event via this si on passait event, mais plus simple :) 
            // On va juste reactiver les classes bas√©es sur l'ordre, ou plus simple :
            const buttons = document.querySelectorAll('.tab-btn');
            if(tabName === 'buildings') buttons[0].classList.add('active');
            if(tabName === 'prestige') buttons[1].classList.add('active');
            if(tabName === 'stats') buttons[2].classList.add('active');
        };

        // Init
        loadGame();
        renderBuildings();
        updateUI();

    </script>
</body>
</html>